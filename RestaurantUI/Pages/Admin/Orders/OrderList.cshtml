@page
@model RestaurantUI.Pages.Admin.Orders.OrderListModel
@{
    ViewBag.groupePage = "Administaration";
    ViewBag.title = "Menu Item List";
}
<div class="p-1">
    <div class="col-12">
        <a class="btn btn-outline-primary mt-1 mb-2 p-1" asp-page="AddOrEdit">
            <i class="fa-solid fa-circle-plus fa-spin"></i> Create
        </a>
        <table id="DtMenuItems" class="w-100 table table-bordered table-striped">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(model=> model.orderList.ElementAt(0).Id)</th>
                    <th>@Html.DisplayNameFor(model=> model.orderList.ElementAt(0).PickUpDate)</th>
                    <th>@Html.DisplayNameFor(model=> model.orderList.ElementAt(0).ApplicationUser.Email)</th>
                    <th>@Html.DisplayNameFor(model=> model.orderList.ElementAt(0).ApplicationUser.PhoneNumber)</th>
                    <th>@Html.DisplayNameFor(model=> model.orderList.ElementAt(0).OrderTotal)</th>
                    <th>@Html.DisplayNameFor(model=> model.orderList.ElementAt(0).Status)</th>
                    <th>Action</th>

                </tr>
            </thead>

            <tbody>
            </tbody>
        </table>
    </div>
</div>

@section Scripts{

    <script type="text/javascript">
        var datatable;
        $(document).ready(function () {

            datatable = $('#DtMenuItems').DataTable({
                "ajax": {
                    "url": "?handler=List",
                    "type": "GET",
                    "datatype": "json",
                },
                "columns": [
                    { "data": "id" },
                    { "data": "pickUpDate" },
                    { "data": "applicationUser.Email" },
                    { "data": "applicationUser.PhoneNumber" },
                    { "data": "orderTotal" },
                    { "data": "status" }
                    {
                        "data": "id", "render": function (data)// data is the id
                        {
                            return `

                                                 <div class="w-100 btn-group" role="group" aria-label="Basic example">
                                                   <a href="/Admin/MenuItems/AddOrEdit?id=${data}"  class="btn btn-outline-info">
                                                     <i class="fa-solid fa-pencil fa-lg" style="color:deepskyblue"></i>
                                                   </a>
                                                     <a onClick="DeleteConfirm(${data})"  class="btn btn-outline-info">
                                                       <i class="fa-solid fa-trash fa-lg" style="color:red"></i>
                                                    </a>
                                                </div>

                                             `

                        }//href="/Admin/MenuItems/AddOrEdit?Handler=Delete&id=${data}"
                    }

                ]
            });



        });

        function DeleteConfirm(id) {
            let urlHandler = "/Admin/MenuItems/AddOrEdit?Handler=Delete&id=" + id;

            const swalWithBootstrapButtons = Swal.mixin({
                customClass: {
                    confirmButton: 'btn btn-success',
                    cancelButton: 'btn btn-danger'
                },
                buttonsStyling: false
            })


            swalWithBootstrapButtons.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'No, cancel!',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {

                    $.ajax({
                        url: urlHandler,
                        type: "GET",
                        success: function (data) {
                            if (data != null) {
                                datatable.ajax.reload();
                                swalWithBootstrapButtons.fire(
                                    'Deleted!',
                                    'Your file has been deleted.',
                                    'success'
                                )



                            }

                        }// end function success

                    }); // end ajax

                } else if (
                    /* Read more about handling dismissals below */
                    result.dismiss === Swal.DismissReason.cancel
                ) {
                    swalWithBootstrapButtons.fire(
                        'Cancelled',
                        'Your imaginary file is safe :)',
                        'error'
                    )
                }
            })




        } // end function

    </script>
}